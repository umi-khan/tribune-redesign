/*
    SocialShare - jQuery plugin
*/
(function ($) {
    function get_class_list(elem){
        if(elem.classList){
            return elem.classList;
        }else{
            return $(elem).attr('class').match(/\S+/gi);
        }
    }

    $.fn.ShareLink = function(options){
        var defaults = {
            title: '',
            text: '',
            image: '',
            url: window.location.href,
            class_prefix: 's_'
        };

        var options = $.extend({}, defaults, options);

        var class_prefix_length = options.class_prefix.length;

        var templates = {
            twitter: 'https://twitter.com/intent/tweet?url={url}&text={title}',
            facebook: 'https://www.facebook.com/sharer.php?m2w&s=100&p[title]={title}&p[summary]={text}&p[url]={url}&p[images][0]={image}'

        }

        function link(network){
            var url = templates[network];
            url = url.replace('{url}', encodeURIComponent(options.url));
            url = url.replace('{title}', encodeURIComponent(options.title));
            url = url.replace('{text}', encodeURIComponent(options.text));
            url = url.replace('{image}', encodeURIComponent(options.image));
            return url;
        }
        this.each(function(i, elem){
            var classlist = get_class_list(elem);
            for(var i = 0; i < classlist.length; i++){
                var cls = classlist[i];
                if(cls.substr(0, class_prefix_length) == options.class_prefix && templates[cls.substr(class_prefix_length)]){
                    var final_link = link(cls.substr(class_prefix_length));
                    $(elem).attr('href', final_link).click(function(){
                        var screen_width = screen.width;
                        var screen_height = screen.height;
                        var popup_width = options.width ? options.width : (screen_width - (screen_width*0.2));
                        var popup_height = options.height ? options.height : (screen_height - (screen_height*0.2));
                        var left = (screen_width/2)-(popup_width/2);
                        var top = (screen_height/2)-(popup_height/2);
                        var parameters = 'toolbar=0,status=0,width=550,height=350,top=' + top + ',left=' + left;
                        return window.open($(this).attr('href'), '', parameters) && false;
                    });
                }
            }
        });
    }
    $.fn.ShareCounter = function(options){
        var defaults = {
            url: window.location.href,
            class_prefix: 'to',
            display_counter_from: 0
        };
        var options = $.extend({}, defaults, options);
        var class_prefix_length = options.class_prefix.length
        var social = {
            'twitter': twitter,
            'facebook': facebook,
            'total': total
        }
        this.each(function(i, elem){
            var classlist = get_class_list(elem);
            for(var i = 0; i < classlist.length; i++){
                var cls = classlist[i];
                if(cls.substr(0, class_prefix_length) == options.class_prefix && social[cls]){
                    social[cls](options.url, function(count){
                        if (count >= options.display_counter_from){
                            if (social[cls.substr(class_prefix_length)] == twitter){
                                $(elem).text("(" + addCommas( count ) + ")" );
                            }else{
                                $(elem).text( addCommas( count ));
                            }
                            
                        }
                    })
                }
            }
        });
        function twitter(url, callback){
            $.ajax({
                type : 'GET',
                dataType : 'jsonp',
                url : 'https://cdn.api.twitter.com/1/urls/count.json',
                data : {'url': url}
            })
            .done(function(data){callback(data.count);})
            .fail(function(data){callback(0);})
        }

        function facebook(url, callback){
            $.ajax({
                type: 'GET',
                dataType: 'jsonp',
                url: 'https://api.facebook.com/restserver.php',
                data: {'method': 'links.getStats', 'urls': [url], 'format': 'json'}
            })
            .done(function (data){callback(data[0].share_count)})
            .fail(function(){callback(0);})
        }

        function total(url, callback){
            var totalcount = 0;
            $.when(
               $.ajax({
                    type: 'GET',
                    dataType: 'jsonp',
                    url: 'https://api.facebook.com/restserver.php',
                    data: {'method': 'links.getStats', 'urls': [url], 'format': 'json'}
                 })
	//	, 
        //        $.ajax({
        //            type : 'GET',
        //            dataType : 'jsonp',
        //            url : 'https://cdn.api.twitter.com/1/urls/count.json',
        //            data : {'url': url}
        //        })
            ).done(function( a1 ) {
               totalcount = a1[0].total_count + 0; //a2[0].count;
               callback( totalcount.toFixed() ) });
        }
        function addCommas(nStr)
        {
            nStr += '';
            x = nStr.split('.');
            x1 = x[0];
            x2 = x.length > 1 ? '.' + x[1] : '';
            var rgx = /(\d+)(\d{3})/;
            while (rgx.test(x1)) {
                x1 = x1.replace(rgx, '$1' + ',' + '$2');
            }
            return x1 + x2;
        }
    }
})(jQuery);


(function($) {
    function windowSize() {
      windowHeight = window.innerHeight ? window.innerHeight : $(window).height();
      windowWidth = window.innerWidth ? window.innerWidth : $(window).width();
    }
    windowSize();
     $( window ).resize(function() {
        windowSize();
     });
       var stickyHeaderTop = $('#socialshare').offset().top;
      $(window).scroll(function(){
              if( $(window).scrollTop() > stickyHeaderTop ) {
                     if(windowWidth > 900){
                        $('.stickybar').css({position: 'fixed', top: '0px'});
                        $('.stickybar').css('display', 'block');
                      }else{
                        $('.stickybar').css('display', 'none');
                      }
              } else {
                      $('.stickybar').css({position: 'static', top: '0px'});
                      $('.stickybar').css('display', 'none');
              }
        });

         $(".more_social").on("click", function(){
        $(this).siblings($(".more_social_secondary")).toggleClass("show");
        $(this).toggleClass("transform");
      });

      $(document).ready(function() {
        $('.share').ShareLink({
          title: shareTitle,
          text: shareText,
          image: shareImage,
          url: shareUrl
        });

       $('.total').ShareCounter({
         url: shareUrl
        });
      });
    $('.ss-email').click(function(event) {
          var w = 550, h = 450, left = Number((screen.width/2)-(w/2)), tops = Number((screen.height/2)-(h/2));
          event.preventDefault();
          window.open($(this).attr("href"), "popupWindow", "width="+w+", height="+h+", top="+tops+", left="+left);
    });
})(jQuery);
